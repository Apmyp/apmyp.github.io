<!doctype html><html lang=ru prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=canonical href=https://apmyp.pro/posts/math-crc32/><meta name=yandex-verification content="adf9bacf171ef99e"><meta name=google-site-verification content="WTHqdU02rgaCa1-nQGpChuax1GrybYF38phTQkLk4W4"><link rel=stylesheet href=https://apmyp.pro/css/main.min.f37e27cbd1e75055e0dd9a1b9c336c440d6d545637fcbf516321a70736eaecbe7bed273cbe5b7dfb0c628cdecaf6edadf7d4bc9b6a984f0a7375b1695dbcaa74.css integrity="sha512-834ny9HnUFXg3ZobnDNsRA1tVFY3/L9RYyGnBzbq7L577Sc8vlt9+wxijN7K9u2t99S8m2qYTwpzdbFpXbyqdA=="><link rel=alternate type=application/rss+xml href=https://apmyp.pro/index.xml title=RSS><link rel=icon type=image/png href=https://apmyp.pro/favicon@256.png><link rel=apple-touch-icon href=https://apmyp.pro/favicon@256.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=theme-color content="#45046A"><title>Как зафиксировать выбор математически?</title><meta name=description content="CRC спасает интернет. Опять"><meta name=keywords content="блог о разработке,проектное управление,философия,управление рисками,опенсорс,opensource"><meta name=robots content="noodp"><meta name=twitter:card content="summary"><meta name=twitter:description content="CRC спасает интернет. Опять"><meta name=twitter:title content="Как зафиксировать выбор математически?"><meta name=twitter:site content="@apmyp0"><meta name=twitter:creator content="@apmyp0"><meta name=twitter:image content="https://apmyp.pro/images/math-crc32/twitter_og_image.png"><meta property="og:locale" content="ru_RU"><meta property="og:type" content="article"><meta content="Как зафиксировать выбор математически?" property="og:title"><meta content="CRC спасает интернет. Опять" property="og:description"><meta property="og:url" content="https://apmyp.pro/posts/math-crc32/"><meta property="og:site_name" content="Апмип.про"><meta property="og:image" content="https://apmyp.pro/images/math-crc32/og_image.png"><meta property="og:image:secure_url" content="https://apmyp.pro/images/math-crc32/og_image.png"><meta property="article:section" content="development"><meta property="article:published_time" content="2021-04-07T12:10:49"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/apmyp.pro\/posts\/math-crc32\/","name":"Апмип.про","author":{"@type":"Person","name":"Arthur Bordenyuk","sameAs":["https://twitter.com/apmyp0"]},"description":"Артур Борденюк ведет блог о разработке, продуктоводстве, опенсорсе, проектном управлении и философии, новый пост каждую неделю","sameAs":["https://twitter.com/apmyp0"]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Как зафиксировать выбор математически?","genre":"development","url":"https:\/\/apmyp.pro\/posts\/math-crc32\/","datePublished":"2021-04-07T12:10:49","dateCreated":"2021-04-07T12:10:49","dateModified":"2021-04-07T12:10:49","description":"CRC спасает интернет. Опять","image":"https:\/\/apmyp.pro\/images\/math-crc32\/og_image.png","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/apmyp.pro\/posts\/math-crc32\/"},"author":{"@type":"Person","name":"Arthur Bordenyuk","sameAs":["https://twitter.com/apmyp0"]},"publisher":{"@type":"Organization","name":"Arthur Bordenyuk","url":"https:\/\/apmyp.pro\/","logo":{"@type":"ImageObject","url":"https:\/\/apmyp.pro\/favicon.png"},"sameAs":["https://twitter.com/apmyp0"]}}</script></head><body><header class=header><div class="header__wrapper wrapper"><div class=header__logo><a class=header__logo-link href=https://apmyp.pro/><img class=header__logo-image width=187 height=80 src=https://apmyp.pro/images/cube-logo.svg title="Блог о разработке" alt="Блог о разработке"></a></div><nav class="header__menu menu"><button type=button class=menu__button aria-expanded=false aria-controls=menu__list><svg class="menu__icon" aria-hidden="true" width="32" height="32"><use class="menu__icon-menu" href="https://apmyp.pro/images/sprite.svg#menu"/><use class="menu__icon-cross" href="https://apmyp.pro/images/sprite.svg#cross"/></svg></button><ul class=menu__list id=menu__list><li class=menu__item><a href=https://apmyp.pro/ class=menu__link>Все заметки</a></li><li class=menu__item><a href=https://apmyp.pro/books class=menu__link>Книги</a></li><li class=menu__item><a class="menu__link menu__link--disabled">Избранное</a></li><li class=menu__item><a class="menu__link menu__link--disabled">Контакты</a></li></ul></nav></div></header><main><article class=post><div class=wrapper><header><h1>Как зафиксировать выбор математически?</h1><p class=post__info><time datetime=2021-04-07T12:10:49>7
апреля 2021</time></p></header><div class=post-container><div class=post-wrapper><p>Когда у пользователя нет аватарки, часто рисуют цветной кругляш и вписывают туда инициалы пользователя. Есть красивый способ подбирать цвет фона для такой аватарки, почти математически, по имени пользователя.</p><p>Или вот, хочется закодить систему АБ тестов. Как понять попадает ли пользователь в этот АБ тест или нет?</p><p>Можно выбрать случайный цвет для аватарки из палитры и записать этот цвет в базу. А для АБ тестов, просто распределить пользователей по группам попал / не попал и отразить это распределение в таблице пользователей. Но есть способ красивей! Понадобится немного математики, компьютер сайенса и знаний работы сетей (на самом деле можно все скопировать).</p><div class=paragraph-with-factoid><p>Нужно понять что такое циклический избыточный код или CRC. Это функция нахождения контрольной суммы. Обычно используется для проверки целостности данных. Ну типа, потерялся какой-то байтик, так эта математическая магия его угадывает. Так компенсируются микро-потери при передачи данных по сети.</p><div class=factoid><a href=https://ru.wikipedia.org/wiki/%D0%A6%D0%B8%D0%BA%D0%BB%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B9_%D0%B8%D0%B7%D0%B1%D1%8B%D1%82%D0%BE%D1%87%D0%BD%D1%8B%D0%B9_%D0%BA%D0%BE%D0%B4 target=_blank rel="noopener noreferrer" title="Cyclic redundancy check">Cyclic redundancy check</a> на Википедии</div></div><h2 id=цвет-фона-для-аватарки>Цвет фона для аватарки</h2><div class=paragraph-with-factoid><p>Нас интересует возвращаемое значение этой функции —
это число! Мы можем превратить любую строку в понятное число. Вот маленький пример, чтобы было понятно вот прям щас. И есть интерактивный примерчик на Кодпене с комментариями.</p><div class=factoid><a href=https://codepen.io/apmyp/pen/QWdqbzp target=_blank rel="noopener noreferrer" title="Пример на Кодпене">Пример на Кодпене</a> — про цвет аватарки</div></div><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a90d91>const</span> <span style=color:#000>username</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;Arthur Bordenyuk&#34;</span>;
<span style=color:#a90d91>const</span> <span style=color:#000>colors</span> <span style=color:#000>=</span> [<span style=color:#c41a16>&#39;tomato&#39;</span>, <span style=color:#c41a16>&#39;orangered&#39;</span>, <span style=color:#c41a16>&#39;sandybrown&#39;</span>, <span style=color:#c41a16>&#39;darkolivegreen&#39;</span>, <span style=color:#c41a16>&#39;navy&#39;</span>, <span style=color:#c41a16>&#39;rebeccapurple&#39;</span>, <span style=color:#c41a16>&#39;cadetblue&#39;</span>];
  
<span style=color:#177500>// Считаем полином от строки и берем от него модуль
</span><span style=color:#177500></span><span style=color:#a90d91>const</span> <span style=color:#000>positiveCrc32</span> <span style=color:#000>=</span> <span style=color:#a90d91>Math</span>.<span style=color:#000>abs</span>(<span style=color:#000>crc32</span>.<span style=color:#000>str</span>(<span style=color:#000>username</span>));

<span style=color:#177500>// Пока имя пользователя и массив цветов не изменились, индекс будет постоянным
</span><span style=color:#177500></span><span style=color:#a90d91>const</span> <span style=color:#000>computedIndex</span> <span style=color:#000>=</span> <span style=color:#000>positiveCrc32</span> <span style=color:#000>%</span> <span style=color:#000>colors</span>.<span style=color:#000>length</span>;

<span style=color:#a90d91>return</span> <span style=color:#000>colors</span>[<span style=color:#000>computedIndex</span>];
</code></pre></div><h2 id=достоин-ли-пользователь-этого-аб-теста>Достоин ли пользователь этого АБ теста</h2><div class=paragraph-with-factoid><p>Похожим образом будет работать и пример с АБ тестами. Надо все входные значения перевести в числа и начать математическую жесть. Полный пример так же на Кодпене.</p><div class=factoid><a href=https://codepen.io/apmyp/pen/VwPMvMe target=_blank rel="noopener noreferrer" title="Пример на Кодпене">Пример на Кодпене</a> — про попадание пользователя в конкретный АБ тест</div></div><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a90d91>const</span> <span style=color:#000>splitTestName</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#34;someTestName&#34;</span>;
<span style=color:#a90d91>const</span> <span style=color:#000>accountId</span> <span style=color:#000>=</span> <span style=color:#1c01ce>1300</span>;
<span style=color:#a90d91>const</span> <span style=color:#000>DISTRIBUTION_FACTOR</span> <span style=color:#000>=</span> <span style=color:#1c01ce>10007</span>;
<span style=color:#a90d91>const</span> <span style=color:#000>PERCENTAGE_ENABLED</span> <span style=color:#000>=</span> <span style=color:#1c01ce>0.5</span>;

<span style=color:#a90d91>const</span> <span style=color:#000>salt</span> <span style=color:#000>=</span> <span style=color:#a90d91>Math</span>.<span style=color:#000>abs</span>(<span style=color:#000>crc32</span>.<span style=color:#000>str</span>(<span style=color:#000>splitTestName</span>));

<span style=color:#a90d91>return</span> (<span style=color:#000>salt</span> <span style=color:#000>+</span> <span style=color:#000>accountId</span>) <span style=color:#000>%</span> <span style=color:#000>DISTRIBUTION_FACTOR</span> <span style=color:#000>&lt;</span> <span style=color:#000>DISTRIBUTION_FACTOR</span> <span style=color:#000>*</span> <span style=color:#000>PERCENTAGE_ENABLED</span>;
</code></pre></div><p>Вот так математика спасла чью-то маленькую базу данных.</p><p>Цём</p><p class=post__ps>P.S. Свежие посты публикуются в <a title="Канал в телеграме Артур и до" href="tg://resolve?domain=magnificent_apmyp" target=_blank>телеграме</a>. Если чувствуешь, что они
полезны, то подпишись.</p></div></div></div></article><section class=about><h2 class=visually-hidden>Об Артуре Борденюке</h2><div class="wrapper about__wrapper"><b class=about__title>Привет!</b><p class=about__text>Меня зовут Артур. Пишу про код, о&nbsp;проектном управлении и&nbsp;философии<br><br></p><div class=about__image><picture><source type=image/webp srcset="https://apmyp.pro/images/apmyp_large_x2.webp 2x, https://apmyp.pro/images/apmyp_large.webp 1x"><img width=190 height=304 src=https://apmyp.pro/images/apmyp_large.png srcset="https://apmyp.pro/images/apmyp_large_x2.png 2x, https://apmyp.pro/images/apmyp_large.png 1x" alt="Чибик Артура"></picture></div></div></section></main><footer class=footer><div class="wrapper footer__wrapper"><img class=footer__image src=https://apmyp.pro/images/superhero.png title=Superapmyp alt=Superapmyp><div class=footer__info><b class=footer__info-title>для связи:</b><ul class=footer__list><li><a title="Личная почта" target=_blank rel="noopener noreferrer author" href=mailto:me@apmyp.pro>me@apmyp.pro</a></li><li><a target=_blank rel="noopener noreferrer author" href=https://twitter.com/apmyp0>твиттер</a></li><li><a target=_blank rel="noopener noreferrer author" href="tg://resolve?domain=apmyp0">телеграм</a></li><li><a target=_blank rel="author" href="https://apmyp.dev">en blog</a></li></ul></div></div></footer><script src=https://apmyp.pro/js/index.min.8d803b4211a2988b1f124ceda93ae9a319d827c3c1048028c77d22a96f057c96093d30ca224c2b2fc736874032dc8e0e2291da864349b7624a5f8f79b1753ccd.js integrity="sha512-jYA7QhGimIsfEkztqTrpoxnYJ8PBBIAox30iqW8FfJYJPTDKIkwrL8c2h0Ay3I4OIpHahkNJt2JKX495sXU8zQ=="></script><script>(function(a,e,f,g,b,c,d){a[b]=a[b]||function(){(a[b].a=a[b].a||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(40106860,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/40106860 style=position:absolute;left:-9999px alt></div></noscript></body></html>