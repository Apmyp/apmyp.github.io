<!DOCTYPE html>
<html lang="ru"><head>
  <title>How shortener feature works | Апмип.про</title>
  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <link rel='canonical' href='https://apmyp.pro/posts/url-shortener/'>
  <meta name="yandex-verification" content="adf9bacf171ef99e" />
  <meta name="google-site-verification" content="WTHqdU02rgaCa1-nQGpChuax1GrybYF38phTQkLk4W4" />

  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
<link rel="preload" href="https://fonts.googleapis.com/css?family=PT+Sans:wght" as="fetch" crossorigin="anonymous">
<script>
  !function (e, n, t) { "use strict"; var o = "https://fonts.googleapis.com/css?family=PT+Sans:wght", r = "__3perf_googleFonts_60e73"; function c(e) { (n.head || n.body).appendChild(e) } function a() { var e = n.createElement("link"); e.href = o, e.rel = "stylesheet", c(e) } function f(e) { if (!n.getElementById(r)) { var t = n.createElement("style"); t.id = r, c(t) } n.getElementById(r).innerHTML = e } e.FontFace && e.FontFace.prototype.hasOwnProperty("display") ? (t[r] && f(t[r]), fetch(o).then(function (e) { return e.text() }).then(function (e) { return e.replace(/@font-face {/g, "@font-face{font-display:swap;") }).then(function (e) { return t[r] = e }).then(f).catch(a)) : a() }(window, document, localStorage);
</script>
  <link rel='stylesheet' href='https://apmyp.pro/css/main.min.c9b4b8db856411c2526c08af04dffa1ef171add0dce6cef9d8725f2af93f0fcb90e9dc8109141b82d97a0a36dde97ba0128066eb52c67462065bcf4d959d4182.css' integrity='sha512-ybS424VkEcJSbAivBN/6HvFxrdDc5s752HJfKvk/D8uQ6dyBCRQbgtl6Cjbd6XugEoBm61LGdGIGW89NlZ1Bgg=='>

  <link rel="icon" type="image/png" href="https://apmyp.pro/favicon.png">
<link rel="apple-touch-icon" sizes="180x180"
  href="https://apmyp.pro/favicon.png" />
<meta name="theme-color" content="#45046A">
  <meta name="description" content="Arthur Bordenyuk is going to explain how to implement url shortener">
<meta name="robots" content="noodp">

<meta name="twitter:card" content="summary">
<meta name="twitter:description"
  content="Arthur Bordenyuk is going to explain how to implement url shortener">
<meta name="twitter:title"
  content="How shortener feature worksАпмип.про">
<meta name="twitter:site" content="">
<meta name="twitter:creator" content="">

<meta property="og:locale" content="ru_RU">
<meta property="og:type" content="article">
<meta content="How shortener feature works" property="og:title">
<meta content="Arthur Bordenyuk is going to explain how to implement url shortener" property="og:description">
<meta property="og:url" content="https://apmyp.pro/posts/url-shortener/">
<meta property="og:site_name" content="Апмип.про">

  <meta property="og:image" content="https://apmyp.pro/og_image.png" />
  <meta property="og:image:secure_url" content="https://apmyp.pro/og_image.png" />



<meta property="article:section" content="case">



<meta property="article:published_time" content="2020-05-26T13:24:02">


<script type="application/ld+json">
  { 
    "@context": "http://schema.org", 
    "@type": "WebSite", 
    "url": "https:\/\/apmyp.pro\/posts\/url-shortener\/", 
    "name": "Апмип.про",
      "author": {
        "@type": "Person",
        "name": "Arthur Bordenyuk"
      },
    "description": "Артур Борденюк ведет блог о разработке, проектном управлении и философии, новый пост каждую неделю"
  }
  </script>


<script type="application/ld+json">
    { 
        "@context": "http://schema.org", 
        "@type": "BlogPosting",
        "headline": "How shortener feature works",
        "genre": "case",  
        "url": "https:\/\/apmyp.pro\/posts\/url-shortener\/",
        "datePublished": "2020-05-26T13:24:02",
        "dateCreated": "2020-05-26T13:24:02",
        "dateModified": "2020-05-26T13:24:02",
        "description": "Arthur Bordenyuk is going to explain how to implement url shortener",
        "image": "https:\/\/apmyp.pro\/og_image.png",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https:\/\/apmyp.pro\/posts\/url-shortener\/"
        },
        "author": {
            "@type": "Person",
            "name": "Arthur Bordenyuk"
        },
        "publisher": {
          "@type": "Organization",
          "name": "Arthur Bordenyuk",
          "logo": {
            "@type": "ImageObject",
            "url": "https:\/\/apmyp.pro\/favicon.png"
          }
        }
      }
    </script>

</head><body><header class="header">
  <div class="wrapper">
    <div class="logo">
      <a href="https://apmyp.pro/">
        <img src="https://apmyp.pro/images/logo.svg" alt="Apmyp">
      </a>
    </div>
    <nav class="menu">
      <ul class="menu__list">
        
          
              <li class="menu__list-item">
                <a class="menu__link" href="https://apmyp.pro/">
                  Все заметки
                </a>
              </li>
              
                  <li class="menu__list-item">
                    
                      
                        <a class="menu__link" href="https://apmyp.pro/categories/case">
                          Кейсы
                        </a>
                      
                    
                  </li>
              
                  <li class="menu__list-item">
                    
                      
                        <a class="menu__link" href="https://apmyp.pro/categories/checklist">
                          Чеклисты
                        </a>
                      
                    
                  </li>
              
                  <li class="menu__list-item">
                    
                      
                        <a class="menu__link" href="https://apmyp.pro/categories/development">
                          Разработка
                        </a>
                      
                    
                  </li>
              
                  <li class="menu__list-item">
                    
                      
                        <a class="menu__link" href="https://apmyp.pro/categories/lifehack">
                          Лайфхаки
                        </a>
                      
                    
                  </li>
              
                  <li class="menu__list-item">
                    
                      
                        <a class="menu__link" href="https://apmyp.pro/categories/person">
                          Личность
                        </a>
                      
                    
                  </li>
              
                  <li class="menu__list-item">
                    
                      
                        <a class="menu__link" href="https://apmyp.pro/categories/principle">
                          Принципы
                        </a>
                      
                    
                  </li>
              
          
        
      </ul>
    </nav>
  </div>
</header><main><div class="post">
  <div class="wrapper">
    <h1>How shortener feature works</h1>
    <p class="post__info"><time datetime="2020-05-26T13:24:02">26
      мая 2020</time></p>

    <div class="post-wrapper">
      <p>I have to make a system which can give us short version of URL and a way to track clicks.</p>
<p>This gist is about how I solved the first part of problem: as short as possible URL.</p>
<p>First things first. If we talk about system which handle URLs then we should have a table in database.</p>
<p>Example table of URLs:</p>
<!-- raw HTML omitted -->
<p>My solution is to convert urls ID into base-n number system. This way allows to leave the database table as it is.</p>
<p>For example if we convert last url ID 174579021 to base 16 we will get A67DD4D. But if we convert the same ID to base 64 with custom chars (from javascript example below) we will get 9OxpC.</p>
<p>Now I can implement simple action <code>/:convertedID</code> , convert ID back to decimal and search the ID through primary key.</p>
<p>Benefits:</p>
<ul>
<li>DB table remains the same</li>
<li>User sees pseudo-random (because of converted primary key) short link</li>
<li>No one cannot search through other links until they know char set</li>
</ul>
<h2 id="about-author">About author</h2>
<!-- raw HTML omitted -->
<p>Shortener implementation:</p>
<pre><code>function shortener() {
  const chars = '-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz'.split('');
  const count = chars.length;
  
  function encode(num) {
    if ( num === 0 ) {
      return &quot;&quot;;
    } else if ( num &gt; 0 ) {
      return encode(parseInt(num / count, 10)) + chars[num % count];
    }
  }
  
  function decode(str) {
    return str.split('').reduce((num, val) =&gt; { 
      return num * count + chars.indexOf(val);
    }, 0);
  }

	return {
  	encode,
    decode
  };
}

export { shortener };
</code></pre><p>Shortener example:</p>
<pre><code>import { shortener } from &quot;./shorten.js&quot;;

const { encode, decode } = shortener();

encode(1233); // =&gt; 'IG'
decode(encode(1233)); // =&gt; 1233

encode(112233); // =&gt; 'QOd'
decode(encode(112233)); // =&gt; 112233

encode(1000000000); // =&gt; 'vagc-'
decode(encode(1000000000)); // =&gt; 1000000000
</code></pre>
    </div>
  </div>
</div><section class="about">
  <div class="wrapper about__wrapper">
    <b class="about__title">Привет!</b>
    <p class="about__text">
      Меня зовут Артур. Раньше работал тимлидом
      и&nbsp;фуллстэк-разработчиком.<br /><br />
      
      Сейчас я&nbsp;<a class="about__link" href="tg://resolve?domain=apmyp0" target="_blank" rel="noopener noreferer">ищу работу</a>.
    </p>
    <div class="about__image"></div>
  </div>
</section>
        </main><footer class="footer">
  <div class="wrapper footer__wrapper">
    <img class="footer__image" src="https://apmyp.pro/images/superhero.png" alt="Superapmyp">
    <div class="footer__info">
      <b class="footer__info-title">для связи:</b>
      <ul  class="footer__list">
        <li>
          <a href="mailto:me@apmyp.pro">me@apmyp.pro</a>
        </li>
        <li>
          <a href="tg://resolve?domain=apmyp0">телеграм</a>
        </li>
      </ul>
    </div>
  </div>
</footer>



<script src='https://apmyp.pro/js/index.min.d9a4d039896c12a15d39ba7d46da823a7abb9cfad5df89749295f453fb3e716b1c88ef0f197c4bd96dfc08c2a93f4936eca96d70aa3c4540fedb773d35e983ac.js' integrity="sha512-2aTQOYlsEqFdObp9RtqCOnq7nPrV34l0kpX0U/s&#43;cWsciO8PGXxL2W38CMKpP0k27KltcKo8RUD&#43;23c9NemDrA=="></script>


<script> (function (m, e, t, r, i, k, a) { m[i] = m[i] || function () { (m[i].a = m[i].a || []).push(arguments) }; m[i].l = 1 * new Date(); k = e.createElement(t), a = e.getElementsByTagName(t)[0], k.async = 1, k.src = r, a.parentNode.insertBefore(k, a) })(window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(40106860, "init", { clickmap: true, trackLinks: true, accurateTrackBounce: true }); </script>
<noscript>
  <div><img src="https://mc.yandex.ru/watch/40106860" style="position:absolute; left:-9999px;" alt="" /></div>
</noscript> </body>
</html>
