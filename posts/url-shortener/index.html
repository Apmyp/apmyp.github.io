<!doctype html><html lang=ru prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><link rel=canonical href=https://apmyp.pro/posts/url-shortener/><meta name=yandex-verification content="adf9bacf171ef99e"><meta name=google-site-verification content="WTHqdU02rgaCa1-nQGpChuax1GrybYF38phTQkLk4W4"><link rel=stylesheet href=https://apmyp.pro/css/main.min.9b8fa6ab44201079f6f73d483339102afa415551c5cb75bbb3964896634d738224754f445d4b31c4d8e6a7fe7f6b09733bafc092e16fe6868a28bd1d83739209.css integrity="sha512-m4+mq0QgEHn29z1IMzkQKvpBVVHFy3W7s5ZIlmNNc4IkdU9EXUsxxNjmp/5/awlzO6/AkuFv5oaKKL0dg3OSCQ=="><link rel=alternate type=application/rss+xml href=https://apmyp.pro/index.xml title=RSS><link rel=icon type=image/png href=https://apmyp.pro/favicon@256.png><link rel=apple-touch-icon href=https://apmyp.pro/favicon@256.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=theme-color content="#45046A"><title>How shortener feature works</title><meta name=description content="Arthur Bordenyuk is going to explain how to implement url shortener"><meta name=keywords content="блог о разработке,проектное управление,философия,управление рисками,опенсорс,opensource"><meta name=robots content="noodp"><meta name=twitter:card content="summary"><meta name=twitter:description content="Arthur Bordenyuk is going to explain how to implement url shortener"><meta name=twitter:title content="How shortener feature works"><meta name=twitter:site content="@apmyp0"><meta name=twitter:creator content="@apmyp0"><meta name=twitter:image content="https://apmyp.pro/twitter_og_image.png"><meta property="og:locale" content="ru_RU"><meta property="og:type" content="article"><meta content="How shortener feature works" property="og:title"><meta content="Arthur Bordenyuk is going to explain how to implement url shortener" property="og:description"><meta property="og:url" content="https://apmyp.pro/posts/url-shortener/"><meta property="og:site_name" content="Апмип.про"><meta property="og:image" content="https://apmyp.pro/og_image.png"><meta property="og:image:secure_url" content="https://apmyp.pro/og_image.png"><meta property="article:section" content="development"><meta property="article:published_time" content="2020-05-26T13:24:02"><script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","url":"https:\/\/apmyp.pro\/posts\/url-shortener\/","name":"Апмип.про","author":{"@type":"Person","name":"Arthur Bordenyuk","sameAs":["https://twitter.com/apmyp0"]},"description":"Артур Борденюк ведет блог о разработке, продуктоводстве, опенсорсе, проектном управлении и философии, новый пост каждую неделю","sameAs":["https://twitter.com/apmyp0"]}</script><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How shortener feature works","genre":"development","url":"https:\/\/apmyp.pro\/posts\/url-shortener\/","datePublished":"2020-05-26T13:24:02","dateCreated":"2020-05-26T13:24:02","dateModified":"2020-05-26T13:24:02","description":"Arthur Bordenyuk is going to explain how to implement url shortener","image":"https:\/\/apmyp.pro\/og_image.png","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/apmyp.pro\/posts\/url-shortener\/"},"author":{"@type":"Person","name":"Arthur Bordenyuk","sameAs":["https://twitter.com/apmyp0"]},"publisher":{"@type":"Organization","name":"Arthur Bordenyuk","url":"https:\/\/apmyp.pro\/","logo":{"@type":"ImageObject","url":"https:\/\/apmyp.pro\/favicon.png"},"sameAs":["https://twitter.com/apmyp0"]}}</script></head><body><header class=header><div class="header__wrapper wrapper"><div class=header__logo><a class=header__logo-link href=https://apmyp.pro/><img class=header__logo-image width=187 height=80 src=https://apmyp.pro/images/cube-logo.svg title="Блог о разработке" alt="Блог о разработке"></a></div><nav class="header__menu menu"><button type=button class=menu__button aria-expanded=false aria-controls=menu__list><svg class="menu__icon" aria-hidden="true" width="32" height="32"><use class="menu__icon-menu" href="https://apmyp.pro/images/sprite.svg#menu"/><use class="menu__icon-cross" href="https://apmyp.pro/images/sprite.svg#cross"/></svg></button><ul class=menu__list id=menu__list><li class=menu__item><a href=https://apmyp.pro/ class=menu__link>Все заметки</a></li><li class=menu__item><a href=https://apmyp.pro/books class=menu__link>Книги</a></li><li class=menu__item><a class="menu__link menu__link--disabled">Избранное</a></li><li class=menu__item><a class="menu__link menu__link--disabled">Контакты</a></li></ul></nav></div></header><main><article class=post><div class=wrapper><header><h1>How shortener feature works</h1><p class=post__info><time datetime=2020-05-26T13:24:02>26
мая 2020</time></p></header><div class=post-container><div class=post-wrapper><p>I have to make a system which can give us short version of URL and a way to track clicks.</p><p>This gist is about how I solved the first part of problem: as short as possible URL.</p><p>First things first. If we talk about system which handle URLs then we should have a table in database.</p><p>Example table of URLs:</p><table><tr><th>ID</th><th>URL</th></tr><tr><td>1</td><td>https://example.com/</td></tr><tr><td>2</td><td>https://reddit.com/</td></tr><tr><td colspan=2>…</td></tr><tr><td>174579021</td><td>https://random.cat/</td></tr></table><p>My solution is to convert urls ID into base-n number system. This way allows to leave the database table as it is.</p><p>For example if we convert last url ID 174579021 to base 16 we will get A67DD4D. But if we convert the same ID to base 64 with custom chars (from javascript example below) we will get 9OxpC.</p><p>Now I can implement simple action <code>/:convertedID</code>, convert ID back to decimal and search the ID through primary key.</p><p>Benefits:</p><ul><li>DB table remains the same</li><li>User sees pseudo-random (because of converted primary key) short link</li><li>No one cannot search through other links until they know char set</li></ul><p>Shortener implementation:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a90d91>function</span> <span style=color:#000>shortener</span>() {
  <span style=color:#a90d91>const</span> <span style=color:#000>chars</span> <span style=color:#000>=</span> <span style=color:#c41a16>&#39;-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz&#39;</span>.<span style=color:#000>split</span>(<span style=color:#c41a16>&#39;&#39;</span>);
  <span style=color:#a90d91>const</span> <span style=color:#000>count</span> <span style=color:#000>=</span> <span style=color:#000>chars</span>.<span style=color:#000>length</span>;

  <span style=color:#a90d91>function</span> <span style=color:#000>encode</span>(<span style=color:#000>num</span>) {
    <span style=color:#a90d91>if</span> ( <span style=color:#000>num</span> <span style=color:#000>===</span> <span style=color:#1c01ce>0</span> ) {
      <span style=color:#a90d91>return</span> <span style=color:#c41a16>&#34;&#34;</span>;
    } <span style=color:#a90d91>else</span> <span style=color:#a90d91>if</span> ( <span style=color:#000>num</span> <span style=color:#000>&gt;</span> <span style=color:#1c01ce>0</span> ) {
      <span style=color:#a90d91>return</span> <span style=color:#000>encode</span>(<span style=color:#a90d91>parseInt</span>(<span style=color:#000>num</span> <span style=color:#000>/</span> <span style=color:#000>count</span>, <span style=color:#1c01ce>10</span>)) <span style=color:#000>+</span> <span style=color:#000>chars</span>[<span style=color:#000>num</span> <span style=color:#000>%</span> <span style=color:#000>count</span>];
    }
  }

  <span style=color:#a90d91>function</span> <span style=color:#000>decode</span>(<span style=color:#000>str</span>) {
    <span style=color:#a90d91>return</span> <span style=color:#000>str</span>.<span style=color:#000>split</span>(<span style=color:#c41a16>&#39;&#39;</span>).<span style=color:#000>reduce</span>((<span style=color:#000>num</span>, <span style=color:#000>val</span>) =&gt; {
      <span style=color:#a90d91>return</span> <span style=color:#000>num</span> <span style=color:#000>*</span> <span style=color:#000>count</span> <span style=color:#000>+</span> <span style=color:#000>chars</span>.<span style=color:#000>indexOf</span>(<span style=color:#000>val</span>);
    }, <span style=color:#1c01ce>0</span>);
  }

	<span style=color:#a90d91>return</span> {
  	<span style=color:#000>encode</span>,
    <span style=color:#000>decode</span>
  };
}

<span style=color:#a90d91>export</span> { <span style=color:#000>shortener</span> };
</code></pre></div><p>Shortener example:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#a90d91>import</span> { <span style=color:#000>shortener</span> } <span style=color:#000>from</span> <span style=color:#c41a16>&#34;./shorten.js&#34;</span>;

<span style=color:#a90d91>const</span> { <span style=color:#000>encode</span>, <span style=color:#000>decode</span> } <span style=color:#000>=</span> <span style=color:#000>shortener</span>();

<span style=color:#000>encode</span>(<span style=color:#1c01ce>1233</span>); <span style=color:#177500>// =&gt; &#39;IG&#39;
</span><span style=color:#177500></span><span style=color:#000>decode</span>(<span style=color:#000>encode</span>(<span style=color:#1c01ce>1233</span>)); <span style=color:#177500>// =&gt; 1233
</span><span style=color:#177500></span>
<span style=color:#000>encode</span>(<span style=color:#1c01ce>112233</span>); <span style=color:#177500>// =&gt; &#39;QOd&#39;
</span><span style=color:#177500></span><span style=color:#000>decode</span>(<span style=color:#000>encode</span>(<span style=color:#1c01ce>112233</span>)); <span style=color:#177500>// =&gt; 112233
</span><span style=color:#177500></span>
<span style=color:#000>encode</span>(<span style=color:#1c01ce>1000000000</span>); <span style=color:#177500>// =&gt; &#39;vagc-&#39;
</span><span style=color:#177500></span><span style=color:#000>decode</span>(<span style=color:#000>encode</span>(<span style=color:#1c01ce>1000000000</span>)); <span style=color:#177500>// =&gt; 1000000000
</span></code></pre></div><p class=post__ps>P.S. Свежие посты публикуются в <a title="Канал в телеграме Артур и до" href="tg://resolve?domain=magnificent_apmyp" target=_blank>телеграме</a>. Если чувствуешь, что они
полезны, то подпишись.</p></div></div></div></article><section class=about><h2 class=visually-hidden>Об Артуре Борденюке</h2><div class="wrapper about__wrapper"><b class=about__title>Привет!</b><p class=about__text>Меня зовут Артур. Пишу про код, о&nbsp;проектном управлении и&nbsp;философии<br><br></p><div class=about__image><picture><source type=image/webp srcset="https://apmyp.pro/images/apmyp_large_x2.webp 2x, https://apmyp.pro/images/apmyp_large.webp 1x"><img width=190 height=304 src=https://apmyp.pro/images/apmyp_large.png srcset="https://apmyp.pro/images/apmyp_large_x2.png 2x, https://apmyp.pro/images/apmyp_large.png 1x" alt="Чибик Артура"></picture></div></div></section></main><footer class=footer><div class="wrapper footer__wrapper"><img class=footer__image src=https://apmyp.pro/images/superhero.png title=Superapmyp alt=Superapmyp><div class=footer__info><b class=footer__info-title>для связи:</b><ul class=footer__list><li><a title="Личная почта" target=_blank rel="noopener noreferrer author" href=mailto:me@apmyp.pro>me@apmyp.pro</a></li><li><a target=_blank rel="noopener noreferrer author" href=https://twitter.com/apmyp0>твиттер</a></li><li><a target=_blank rel="noopener noreferrer author" href="tg://resolve?domain=apmyp0">телеграм</a></li></ul></div></div></footer><script src=https://apmyp.pro/js/index.min.8d803b4211a2988b1f124ceda93ae9a319d827c3c1048028c77d22a96f057c96093d30ca224c2b2fc736874032dc8e0e2291da864349b7624a5f8f79b1753ccd.js integrity="sha512-jYA7QhGimIsfEkztqTrpoxnYJ8PBBIAox30iqW8FfJYJPTDKIkwrL8c2h0Ay3I4OIpHahkNJt2JKX495sXU8zQ=="></script><script>(function(a,e,f,g,b,c,d){a[b]=a[b]||function(){(a[b].a=a[b].a||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(40106860,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/40106860 style=position:absolute;left:-9999px alt></div></noscript></body></html>